# Kenzan laptop specific .bashrc settings
# Should be sourced by .bashrc

# Caveats for "brew install coreutils"
# If you really need to use these commands with their normal names, you
# can add a "gnubin" directory to your PATH from your bashrc like:
PATH="/usr/local/opt/coreutils/libexec/gnubin:$PATH"

# Places
alias projects='cd ~/Documents/projects'
alias training='cd ~/Documents/projects/training'
alias blue='cd ~/Documents/projects/blue-team'
alias notes='cd "${notes}"'

# Charter
alias devolympus='ssh olympus.dev-charter.net'
alias engprodolympus='ssh olympus.engprod-charter.net'

# Clear IntelliJ 'ignored files' list that's created when deleting an Intellij Maven module
function restore_intellij_modules() {
	xmlstarlet ed -P -L -d '/project/component/option[@name="ignoredFiles"]' /code/BlueTeam/.idea/misc.xml
}

# Early days at Kenzan
alias accounts="vi '${notes}/accounts.txt'"
alias todo="vi '${notes}/todo.txt'"

function open_pages() {
	echo "Opening..."
	for i in "$@"; do
		echo "${i}"
		open "${i}"
	done
}

function bitbucket() {
	if [ ! -d .git ]; then echo "Change to root Git project directory"; return 1; fi
	local current_branch_name="$(git rev-parse --abbrev-ref HEAD)"
	local repo_name="$(basename $(pwd))"
	local bitbucket_base="https://stash.dev-charter.net"
	local repo_base="${bitbucket_base}/stash/projects/SPC/repos"
	# https://stash.dev-charter.net/stash/projects/SPC/repos/equipment-chtr-data-manager-config/browse
	# https://stash.dev-charter.net/stash/projects/SPC/repos/equipment-chtr-data-manager-config/pull-requests?create
	local pages=()
	local pages+=("${repo_base}/${repo_name}/browse")
	local pages+=("${repo_base}/${repo_name}/pull-requests?create")
	echo "On branch ${current_branch_name}"
	open_pages "${pages[@]}"
}

function jenkins() {
	if [ ! -d .git ]; then echo "Change to root Git project directory"; return 1; fi
	local current_branch_name="$(git rev-parse --abbrev-ref HEAD)"
	local job_name="SPC-$(basename $(pwd))"
	echo "Opens Jenkins pages for ${job_name}"
	echo "Usage: jenkins [optional branch name]"
	echo
	local jenkins_base="https://jenkinsdocker.dev-charter.net"
	local project_home="${jenkins_base}/view/PC%20Equipment"
	local job_home="${project_home}/job/${job_name}"
	local pages=("${project_home}" "${job_home}")
	if [ "$1" ]; then
		local branch_name="$1"
	else
		# Escape forward-slash in branch name for use in URLs
		local branch_name="${current_branch_name/\//%252F}"
	fi
	local pages+=("${job_home}/job/${branch_name}")
	local pages+=("${job_home}/job/${branch_name}/build?delay=0sec")
	open_pages "${pages[@]}"
}

# auto-complete
if [ -f $(brew --prefix)/etc/bash_completion ]; then
. $(brew --prefix)/etc/bash_completion
fi

# Added by NVM installation
function nvmcli() {
	export NVM_DIR="$HOME/.nvm"
	[ -s "$NVM_DIR/nvm.sh" ] && \. "$NVM_DIR/nvm.sh"  # This loads nvm
	[ -s "$NVM_DIR/bash_completion" ] && \. "$NVM_DIR/bash_completion"  # This loads nvm bash_completion
}
MANPATH="/usr/local/opt/coreutils/libexec/gnuman:$MANPATH"

function change_java_version() {
	if [ $# -ne 1 ]; then
		echo "Usage: change_java_version <version number>"
	else
		sed -i bak -e 's/.*export JAVA_HOME=.*/export JAVA_HOME=\`\/usr\/libexec\/java_home -v '"$1"'\`/g' ~/.bash_profile
		source ~/.bash_profile
		echo "JAVA_HOME: ${JAVA_HOME}"
		java -version
	fi
}
alias java8='change_java_version 1.8'
alias java10='change_java_version 10'

